<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FTX1005F/S — Practice Exam</title>

  <!-- Tailwind + Math libraries -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjs@11.8.0/lib/browser/math.js"></script>
  <script>
    window.MathJax = { tex: { inlineMath: [['$','$']] }, svg: { fontCache: 'global' } };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

  <style>
    body { font-family: Inter, system-ui, Arial; background: #0b1220; color: #fff; }
    .card { background: rgba(255,255,255,0.05); padding: 16px; border-radius: 10px; }
    .input { padding: .5rem; border-radius: 6px; width: 100%; color: black; }
    button { font-weight: 700; border-radius: 8px; transition: all 0.2s ease; }
    button:hover { opacity: 0.9; }
  </style>
</head>
<body class="min-h-screen flex">

  <!-- Sidebar -->
  <aside class="w-64 bg-[#111a33] border-r border-gray-800 overflow-y-auto p-4">
    <h2 class="text-xl mb-3 font-bold">Topics</h2>
    <ul id="topic-list" class="space-y-2">
      <!-- Loaded dynamically -->
    </ul>
  </aside>

  <!-- Main -->
  <main class="flex-1 p-6 overflow-y-auto">
    <div class="max-w-3xl mx-auto">
      <h1 class="text-3xl mb-3 font-bold">FTX1005F/S — Practice Mode</h1>
      <p class="text-gray-300 mb-4">Each topic includes related exam questions. Numeric answers accept ±0.5% tolerance.</p>

      <div id="exam-card" class="card">
        <div id="q-area">
          <p id="q-id" class="text-sm text-gray-400"></p>
          <h2 id="q-text" class="text-lg font-semibold mb-2"></h2>
          <div id="q-attachments" class="mb-3"></div>
          <div id="q-controls" class="mt-3"></div>
          <div id="q-help" class="mt-3 text-gray-400"></div>
        </div>

        <div class="mt-5 flex flex-wrap gap-2">
          <button id="check-btn" class="bg-green-600 px-4 py-2">Check</button>
          <button id="next-btn" class="bg-blue-600 px-4 py-2">Next</button>
          <button id="show-ans-btn" class="bg-purple-600 px-4 py-2">Show Answer</button>
        </div>

        <div id="result" class="mt-3 text-lg"></div>
        <div id="score" class="mt-4 text-gray-400"></div>
      </div>
    </div>
  </main>

<script>
let topics = [];
let currentTopicIndex = 0;
let currentQIndex = 0;
let score = 0;
let answered = 0;

// Theme Sync
const savedTheme = localStorage.getItem("theme") || "bloodred";
document.documentElement.setAttribute("data-theme", savedTheme);

// Load questions.json
async function loadQuestions() {
  try {
    const res = await fetch('questions.json');
    topics = await res.json();
    renderTopicList();
    loadQuestion(0, 0);
  } catch (err) {
    console.error("Error loading questions:", err);
  }
}

// Render topic sidebar
function renderTopicList() {
  const list = document.getElementById('topic-list');
  list.innerHTML = '';
  topics.forEach((t, i) => {
    const li = document.createElement('li');
    li.innerHTML = `
      <button class="w-full text-left bg-[#1b2640] hover:bg-[#25355a] px-3 py-2 rounded"
        onclick="selectTopic(${i})">${t.topic}</button>`;
    list.appendChild(li);
  });
}

// Select a topic
function selectTopic(i) {
  currentTopicIndex = i;
  currentQIndex = 0;
  score = 0;
  answered = 0;
  loadQuestion(i, 0);
  updateScore();
}

// Load question
function loadQuestion(topicIdx, qIdx) {
  const q = topics[topicIdx].questions[qIdx];
  if (!q) return;
  document.getElementById('q-id').textContent = `${q.id || ''} — ${topics[topicIdx].topic}`;
  document.getElementById('q-text').innerHTML = q.question;
  document.getElementById('q-attachments').innerHTML = q.attachments || '';
  const controls = document.getElementById('q-controls');
  controls.innerHTML = '';
  document.getElementById('result').innerHTML = '';

  // Render controls
  if (q.type === 'numeric') {
    controls.innerHTML = `<input id="ans-input" class="input" placeholder="Enter numeric answer" />`;
  } else if (q.type === 'mcq') {
    q.options.forEach((opt,i)=>{
      controls.insertAdjacentHTML('beforeend', `<div><label><input type="radio" name="mcq" value="${i}" /> ${opt}</label></div>`);
    });
  }
  document.getElementById('q-help').innerHTML = q.hint ? `<strong>Hint:</strong> ${q.hint}` : '';
  if (window.MathJax) MathJax.typesetPromise();
}

// Next button
document.getElementById('next-btn').addEventListener('click', () => {
  const topic = topics[currentTopicIndex];
  currentQIndex = (currentQIndex + 1) % topic.questions.length;
  loadQuestion(currentTopicIndex, currentQIndex);
});

// Check button logic
document.getElementById('check-btn').addEventListener('click', () => {
  const q = topics[currentTopicIndex].questions[currentQIndex];
  const resDiv = document.getElementById('result');
  let correct = false;

  if (q.type === 'numeric') {
    const val = document.getElementById('ans-input').value.trim();
    if (val === '') return resDiv.innerHTML = `<span class="text-yellow-400">Please enter an answer.</span>`;
    try {
      const inputVal = math.evaluate(val);
      const correctVal = parseFloat(q.answer);
      const tol = Math.abs(correctVal * 0.005); // ±0.5%
      if (Math.abs(inputVal - correctVal) <= tol) {
        correct = true;
      }
    } catch {
      resDiv.innerHTML = `<span class="text-red-400">Invalid expression.</span>`;
      return;
    }
  } else if (q.type === 'mcq') {
    const chosen = document.querySelector('input[name="mcq"]:checked');
    if (!chosen) return resDiv.innerHTML = `<span class="text-yellow-400">Select an option.</span>`;
    correct = parseInt(chosen.value) === q.answer;
  }

  if (correct) {
    score++;
    resDiv.innerHTML = `<span class="text-green-400 font-bold">✅ Correct!</span>`;
  } else {
    resDiv.innerHTML = `<span class="text-red-400 font-bold">❌ Incorrect.</span>`;
  }

  answered++;
  updateScore();
});

// Show answer
document.getElementById('show-ans-btn').addEventListener('click', () => {
  const q = topics[currentTopicIndex].questions[currentQIndex];
  const resDiv = document.getElementById('result');
  if (q.type === 'mcq') {
    resDiv.innerHTML = `<span class="text-purple-400">Answer: ${q.options[q.answer]}</span>`;
  } else {
    resDiv.innerHTML = `<span class="text-purple-400">Answer: ${q.answer}</span>`;
  }
});

// Update score display
function updateScore() {
  document.getElementById('score').innerHTML = `Score: ${score}/${answered}`;
}

loadQuestions();
</script>
</body>
</html>
